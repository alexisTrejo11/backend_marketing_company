# ============================================================================
# CAMPAIGN ATTRIBUTION - Revenue attribution and tracking
# ============================================================================

"""
Attribution model type.
"""
enum AttributionModel {
  """
  First touch attribution - 100% to first campaign
  """
  FIRST_TOUCH

  """
  Last touch attribution - 100% to last campaign
  """
  LAST_TOUCH

  """
  Linear attribution - equal credit to all campaigns
  """
  LINEAR

  """
  Time decay - more recent campaigns get more credit
  """
  TIME_DECAY

  """
  Custom weighted attribution
  """
  CUSTOM
}

"""
Campaign attribution details.
"""
type CampaignAttribution {
  """
  Attribution ID
  """
  id: ID!

  """
  Deal ID
  """
  dealId: ID!

  """
  Campaign ID
  """
  campaignId: ID!

  """
  Campaign name
  """
  campaignName: String

  """
  Attribution model used
  """
  attributionModel: AttributionModel!

  """
  Attribution percentage (0-100)
  """
  attributionPercentage: Float!

  """
  Attributed revenue
  """
  attributedRevenue: Float!

  """
  Number of touchpoints
  """
  touchCount: Int!

  """
  Touchpoint timestamps
  """
  touchTimestamps: [String!]!

  """
  First touch weight (for custom model)
  """
  firstTouchWeight: Float

  """
  Last touch weight (for custom model)
  """
  lastTouchWeight: Float

  """
  Linear weight (for custom model)
  """
  linearWeight: Float

  """
  First touchpoint date
  """
  firstTouchDate: String

  """
  Last touchpoint date
  """
  lastTouchDate: String

  """
  Creation date
  """
  createdAt: String!

  """
  Last update date
  """
  updatedAt: String!
}

"""
Attribution model breakdown.
"""
type AttributionModelBreakdown {
  """
  First touch attributions
  """
  firstTouch: Int!

  """
  Last touch attributions
  """
  lastTouch: Int!

  """
  Linear attributions
  """
  linear: Int!

  """
  Time decay attributions
  """
  timeDecay: Int!

  """
  Custom attributions
  """
  custom: Int!
}

"""
Touchpoint analysis.
"""
type TouchpointAnalysis {
  """
  Total touchpoints
  """
  totalTouchpoints: Int!

  """
  Average touchpoints per deal
  """
  averageTouchpointsPerDeal: Float!

  """
  Minimum touchpoints
  """
  minTouchpoints: Int!

  """
  Maximum touchpoints
  """
  maxTouchpoints: Int!

  """
  Touchpoint distribution
  """
  touchpointDistribution: [TouchpointCount!]!
}

"""
Touchpoint count by number.
"""
type TouchpointCount {
  """
  Number of touchpoints
  """
  touchpointNumber: Int!

  """
  Count of deals with this many touchpoints
  """
  count: Int!
}

"""
Revenue distribution.
"""
type RevenueDistribution {
  """
  Minimum attributed revenue
  """
  minAttributedRevenue: Float!

  """
  Maximum attributed revenue
  """
  maxAttributedRevenue: Float!

  """
  Median attributed revenue
  """
  medianAttributedRevenue: Float!

  """
  Revenue by attribution model
  """
  revenueByModel: [ModelRevenue!]!
}

"""
Revenue by model.
"""
type ModelRevenue {
  """
  Attribution model
  """
  model: String!

  """
  Total revenue for this model
  """
  revenue: Float!
}

"""
Comprehensive attribution statistics.
"""
type AttributionStatistics {
  """
  Campaign ID
  """
  campaignId: ID!

  """
  Campaign name
  """
  campaignName: String

  """
  Total attributed revenue
  """
  totalAttributedRevenue: Float!

  """
  Average attribution percentage
  """
  averageAttributionPercentage: Float!

  """
  Total attributions
  """
  totalAttributions: Int!

  """
  Unique deals attributed
  """
  uniqueDealsAttributed: Int!

  """
  Breakdown by attribution model
  """
  modelBreakdown: AttributionModelBreakdown!

  """
  Touchpoint analysis
  """
  touchpointAnalysis: TouchpointAnalysis!

  """
  Revenue distribution
  """
  revenueDistribution: RevenueDistribution!
}

"""
Paginated attribution response.
"""
type AttributionPage implements PageResponse {
  """
  List of attributions
  """
  items: [CampaignAttribution!]!

  """
  Pagination metadata
  """
  pagination: PaginationMetadata!
}

# ============================================================================
# INPUTS
# ============================================================================

"""
Input to create an attribution.
"""
input CreateAttributionInput {
  """
  Deal ID
  """
  dealId: ID!

  """
  Campaign ID
  """
  campaignId: ID!

  """
  Attribution model
  """
  attributionModel: AttributionModel!

  """
  Attribution percentage (0-100)
  """
  attributionPercentage: Float!

  """
  Attributed revenue
  """
  attributedRevenue: Float!

  """
  Touchpoint timestamps (ISO-8601)
  """
  touchTimestamps: [String!]

  """
  First touch weight (for custom model)
  """
  firstTouchWeight: Float

  """
  Last touch weight (for custom model)
  """
  lastTouchWeight: Float

  """
  Linear weight (for custom model)
  """
  linearWeight: Float
}

"""
Input to update an attribution.
"""
input UpdateAttributionInput {
  """
  Attribution ID
  """
  id: ID!

  """
  Attribution percentage (0-100)
  """
  attributionPercentage: Float

  """
  Attributed revenue
  """
  attributedRevenue: Float
}

"""
Input to add a touchpoint.
"""
input AddTouchpointInput {
  """
  Attribution ID
  """
  attributionId: ID!

  """
  Touch timestamp (ISO-8601)
  """
  touchTimestamp: String!
}

"""
Input to recalculate attribution.
"""
input RecalculateAttributionInput {
  """
  Attribution ID
  """
  attributionId: ID!

  """
  New attribution model
  """
  newModel: AttributionModel!
}

"""
Attribution filter options.
"""
input AttributionFilterInput {
  """
  Filter by deal ID
  """
  dealId: ID

  """
  Filter by campaign ID
  """
  campaignId: ID

  """
  Filter by attribution models
  """
  attributionModels: [AttributionModel!]

  """
  Filter by minimum attribution percentage
  """
  minAttributionPercentage: Float

  """
  Filter by maximum attribution percentage
  """
  maxAttributionPercentage: Float

  """
  Filter by minimum attributed revenue
  """
  minAttributedRevenue: Float

  """
  Filter by maximum attributed revenue
  """
  maxAttributedRevenue: Float
}

# ============================================================================
# QUERIES
# ============================================================================

extend type Query {
  """
  Get an attribution by ID.
  """
  attribution(id: ID!): CampaignAttribution

  """
  Search attributions with filters.
  """
  searchAttributions(
    """
    Filter options
    """
    filter: AttributionFilterInput

    """
    Pagination parameters
    """
    pageInput: PageInput!
  ): AttributionPage!

  """
  Get attributions by deal.
  """
  attributionsByDeal(
    """
    Deal ID
    """
    dealId: ID!

    """
    Pagination parameters
    """
    pageInput: PageInput!
  ): AttributionPage!

  """
  Get attributions by campaign.
  """
  attributionsByCampaign(
    """
    Campaign ID
    """
    campaignId: ID!

    """
    Pagination parameters
    """
    pageInput: PageInput!
  ): AttributionPage!

  """
  Get attributions by model.
  """
  attributionsByModel(
    """
    Attribution model
    """
    model: AttributionModel!

    """
    Pagination parameters
    """
    pageInput: PageInput!
  ): AttributionPage!

  """
  Get top attributed campaigns.
  """
  topAttributedCampaigns(
    """
    Pagination parameters
    """
    pageInput: PageInput!
  ): AttributionPage!

  """
  Get attribution statistics for a campaign.
  """
  attributionStatistics(campaignId: ID!): AttributionStatistics!

  """
  Get total attributed revenue for a campaign.
  """
  totalAttributedRevenue(campaignId: ID!): Float!

  """
  Get average attribution percentage.
  """
  averageAttributionPercentage(campaignId: ID!): Float!
}

# ============================================================================
# MUTATIONS
# ============================================================================

extend type Mutation {
  """
  Create a new campaign attribution.
  """
  createAttribution(input: CreateAttributionInput!): CampaignAttribution!

  """
  Update an attribution.
  """
  updateAttribution(input: UpdateAttributionInput!): CampaignAttribution!

  """
  Add a touchpoint to an attribution.
  """
  addTouchpoint(input: AddTouchpointInput!): CampaignAttribution!

  """
  Recalculate attribution with a different model.
  """
  recalculateAttribution(
    input: RecalculateAttributionInput!
  ): CampaignAttribution!

  """
  Delete an attribution (soft delete).
  """
  deleteAttribution(id: ID!): Boolean!
}
