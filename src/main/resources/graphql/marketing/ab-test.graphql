# ============================================================================
# A/B TESTING - Test management and analysis
# ============================================================================

"""
Type of A/B test being conducted.
"""
enum TestType {
    """Standard A/B test"""
    SPLIT_URL,

    """Multivariate test"""
    MULTIVARIATE,

    """Bandit test"""
    BANDIT
}

"""
Current status of the A/B test.
"""
enum TestStatus {
    """Test is in draft state"""
    DRAFT

    """Test is scheduled to start"""
    SCHEDULED

    """Test is currently running"""
    RUNNING

    """Test is paused"""
    PAUSED

    """Test is completed"""
    COMPLETED

    """Test was cancelled"""
    CANCELLED
}

"""
Confidence level for statistical significance.
"""
type ConfidenceLevel {
    """Confidence level value (0.80-0.99)"""
    value: Float!

    """Confidence level as percentage (80-99%)"""
    percentage: Float!

    """Description of confidence level"""
    description: String!
}

"""
Complete A/B test representation (flattened to match Java AbTestOutput DTO exactly).
"""
type AbTestOutput {
    """Test ID"""
    id: ID!

    """Associated campaign ID"""
    campaignId: ID!

    """Test name"""
    testName: String

    """Test hypothesis"""
    hypothesis: String

    """Type of test"""
    testType: TestType

    """Primary metric being tested"""
    primaryMetric: String

    """Confidence level (decimal)"""
    confidenceLevel: BigDecimal

    """Required sample size"""
    requiredSampleSize: Int

    """Control variant"""
    controlVariant: String

    """Treatment variants (JSON)"""
    treatmentVariants: JSON

    """Winning variant"""
    winningVariant: String

    """Statistical significance (decimal)"""
    statisticalSignificance: BigDecimal

    """Is the test completed"""
    isCompleted: Boolean

    """Has test started"""
    hasStarted: Boolean

    """Has test ended"""
    hasEnded: Boolean

    """Test start date/time (ISO)"""
    startDate: DateTime

    """Test end date/time (ISO)"""
    endDate: DateTime

    """Creation date/time"""
    createdAt: DateTime!

    """Last update date/time"""
    updatedAt: DateTime!
}

"""
A/B test statistics for a campaign.
"""
type AbTestStatisticsOutput {
    """Campaign ID"""
    campaignId: ID!

    """Total tests"""
    totalTests: Int!

    """Running tests"""
    runningTests: Int!

    """Completed tests"""
    completedTests: Int!

    """Scheduled tests"""
    scheduledTests: Int!

    """Cancelled tests"""
    cancelledTests: Int!

    """Tests with significant results"""
    significantResults: Int!

    """Average statistical significance"""
    averageSignificance: BigDecimal!

    """Completion rate percentage"""
    completionRate: Int!

    """Average test duration in days"""
    averageTestDuration: Int!

    """Success rate (significant results / completed)"""
    successRate: Int!
}

"""
Paginated A/B test response.
"""
type AbTestPage implements PageResponse {
    """List of A/B tests"""
    items: [AbTestOutput!]!

    """Pagination metadata"""
    pagination: PaginationMetadata!
}

"""
Input to create an A/B test.
"""
input CreateAbTestInput {
    """Campaign ID"""
    campaignId: ID!

    """Test name"""
    testName: String!

    """Test hypothesis"""
    hypothesis: String

    """Test type"""
    testType: TestType

    """Primary metric"""
    primaryMetric: String

    """Confidence level (0.80-0.99)"""
    confidenceLevel: BigDecimal

    """Required sample size"""
    requiredSampleSize: Int

    """Control variant description"""
    controlVariant: String!

    """Treatment variants (JSON)"""
    treatmentVariants: JSON!

    """Start date (ISO format)"""
    startDate: DateTime!
}

"""
Input to update an A/B test.
"""
input UpdateAbTestInput {
    """Test ID"""
    testId: ID!

    """Test hypothesis"""
    hypothesis: String

    """Confidence level (0.80-0.99)"""
    confidenceLevel: BigDecimal

    """Required sample size"""
    requiredSampleSize: Int

    """End date (ISO format)"""
    endDate: DateTime

    """Test type"""
    testType: TestType
}

"""
Input to complete an A/B test.
"""
input CompleteAbTestInput {
    """Test ID"""
    testId: ID!

    """Winning variant identifier"""
    winningVariant: String!

    """Statistical significance (0-1)"""
    statisticalSignificance: BigDecimal!

    """Results summary"""
    resultsSummary: String

    """Detailed variant results (JSON)"""
    variantResults: JSON
}

"""
A/B test filter options.
"""
input AbTestFilterInput {
    """Filter by campaign ID"""
    campaignId: ID

    """Filter by test types"""
    testTypes: [TestType!]

    """Filter by completed status"""
    isCompleted: Boolean

    """Filter by start date from (ISO format)"""
    startDateFrom: DateTime

    """Filter by start date to (ISO format)"""
    startDateTo: DateTime

    """Filter by minimum confidence level"""
    minConfidenceLevel: BigDecimal

    """Search term"""
    searchTerm: String
}

# ============================================================================
# QUERIES
# ============================================================================

extend type Query {
    """
    Get an A/B test by ID.
    """
    abTest(id: ID!): AbTestOutput

    """
    Search A/B tests with filters.
    """
    searchAbTests(
        """Filter options"""
        filter: AbTestFilterInput

        """Pagination parameters"""
        pageInput: PageInput!
    ): AbTestPage!

    """
    Get A/B tests by campaign.
    """
    abTestsByCampaign(
        """Campaign ID"""
        campaignId: ID!

        """Pagination parameters"""
        pageInput: PageInput!
    ): AbTestPage!

    """
    Get completed A/B tests.
    """
    completedAbTests(
        """Pagination parameters"""
        pageInput: PageInput!
    ): AbTestPage!

    """
    Get running A/B tests.
    """
    runningAbTests(
        """Pagination parameters"""
        pageInput: PageInput!
    ): AbTestPage!

    """
    Get scheduled A/B tests.
    """
    scheduledAbTests(
        """Pagination parameters"""
        pageInput: PageInput!
    ): AbTestPage!

    """
    Get A/B test statistics for a campaign.
    """
    abTestStatistics(campaignId: ID!): AbTestStatisticsOutput!

    """
    Get completion rate for a campaign's tests.
    """
    abTestCompletionRate(campaignId: ID!): Float!

    """
    Get average statistical significance for a campaign.
    """
    abTestAverageSignificance(campaignId: ID!): Float!
}

# ============================================================================
# MUTATIONS
# ============================================================================

extend type Mutation {
    """
    Create a new A/B test.
    """
    createAbTest(input: CreateAbTestInput!): AbTestOutput!

    """
    Update an A/B test.
    """
    updateAbTest(input: UpdateAbTestInput!): AbTestOutput!

    """
    Complete an A/B test with results.
    """
    completeAbTest(input: CompleteAbTestInput!): AbTestOutput!

    """
    Delete an A/B test.
    """
    deleteAbTest(id: ID!): Boolean!
}